# Production Helm Values Template
# Copy this file and fill in with actual values
# DO NOT commit filled values to git
# Use: cat production-values.yaml | base64 -w 0 > production-values.b64
# Then add production-values.b64 contents as GitHub secret: PRODUCTION_VALUES

global:
  environment: production
  imageRegistry: ghcr.io/<your-github-username>
  imagePullSecrets:
    - name: ghcr-secret
  imageTag: v1.0.0  # Will be overridden by CI/CD

# Backend service configuration
backend:
  image:
    repository: ghcr.io/<your-github-username>/todo-backend
    tag: v1.0.0  # Overridden by CI/CD
    pullPolicy: IfNotPresent

  replicaCount: 3

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

  env:
    - name: DATABASE_URL
      value: "postgresql://user:password@host:5432/dbname"  # REPLACE
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "kafka:9092"
    - name: LOG_LEVEL
      value: "INFO"
    - name: ENVIRONMENT
      value: "production"

# Notification service
notificationService:
  image:
    repository: ghcr.io/<your-github-username>/todo-notification
    tag: v1.0.0

  replicaCount: 2

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  env:
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "kafka:9092"
    - name: SMTP_HOST
      value: "smtp.gmail.com"  # REPLACE
    - name: SMTP_PORT
      value: "587"
    - name: SMTP_USER
      value: "your-email@gmail.com"  # REPLACE
    - name: SMTP_PASSWORD
      value: "your-app-password"  # REPLACE

# Recurring task service
recurringTaskService:
  image:
    repository: ghcr.io/<your-github-username>/todo-recurring
    tag: v1.0.0

  replicaCount: 2

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  env:
    - name: DATABASE_URL
      value: "postgresql://user:password@host:5432/dbname"  # REPLACE
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "kafka:9092"

# Audit log service
auditLogService:
  image:
    repository: ghcr.io/<your-github-username>/todo-audit
    tag: v1.0.0

  replicaCount: 2

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  env:
    - name: DATABASE_URL
      value: "postgresql://user:password@host:5432/dbname"  # REPLACE
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "kafka:9092"

# Frontend
frontend:
  image:
    repository: ghcr.io/<your-github-username>/todo-frontend
    tag: v1.0.0

  replicaCount: 3

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "400m"

  env:
    - name: NEXT_PUBLIC_API_URL
      value: "https://api.yourdomain.com"  # REPLACE
    - name: NODE_ENV
      value: "production"

# PostgreSQL (External - Neon)
postgresql:
  enabled: false  # Using external Neon PostgreSQL
  externalHost: "ep-production-123456.us-east-1.aws.neon.tech"  # REPLACE
  externalPort: 5432
  database: "todo_production"
  username: "production_user"  # REPLACE
  password: "strong_password"  # REPLACE - Use Kubernetes secret in production
  sslMode: "require"

# Kafka configuration
kafka:
  enabled: true
  replicaCount: 3

  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  persistence:
    enabled: true
    size: 100Gi
    storageClass: "oci-bv"  # OKE block volume

  zookeeper:
    replicaCount: 3
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    persistence:
      enabled: true
      size: 20Gi
      storageClass: "oci-bv"

# Dapr configuration
dapr:
  enabled: true
  logLevel: "warn"  # production log level

  mtls:
    enabled: true
    allowedClockSkew: "15m"

  tracing:
    enabled: true
    samplingRate: "0.1"  # 10% sampling in production
    zipkin:
      endpointAddress: "http://zipkin:9411/api/v2/spans"

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"

  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"  # requests per second
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"

  hosts:
    - host: "yourdomain.com"  # REPLACE
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: frontend
              port: 3000
    - host: "api.yourdomain.com"  # REPLACE
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: backend
              port: 8000

  tls:
    - secretName: production-tls-cert
      hosts:
        - "yourdomain.com"  # REPLACE
        - "api.yourdomain.com"  # REPLACE

# Monitoring and observability
monitoring:
  enabled: true

  prometheus:
    enabled: true
    retention: "30d"
    storageSize: "50Gi"
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"

  grafana:
    enabled: true
    adminPassword: "change-me-in-production"  # REPLACE - Use secret
    persistence:
      enabled: true
      size: "10Gi"

  alertmanager:
    enabled: true
    config:
      route:
        receiver: 'slack-notifications'
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 4h
      receivers:
        - name: 'slack-notifications'
          slack_configs:
            - api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'  # REPLACE
              channel: '#alerts'
              title: 'Production Alert'

# Logging
logging:
  enabled: true
  loki:
    enabled: true
    persistence:
      enabled: true
      size: "50Gi"

# Security policies
networkPolicies:
  enabled: true
  policyTypes:
    - Ingress
    - Egress

  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: production
      ports:
      - protocol: TCP
        port: 8000
      - protocol: TCP
        port: 3000

podSecurityPolicy:
  enabled: true

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Service mesh (optional - if using Istio/Linkerd)
serviceMesh:
  enabled: false
  provider: "istio"  # or "linkerd"

# Backup and disaster recovery
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # days
  storageLocation: "oci-object-storage"

# Cost optimization
costOptimization:
  enabled: true

  # Use spot instances for non-critical workloads
  nodeSelector:
    workload-type: "standard"

  # Cluster autoscaler configuration
  clusterAutoscaler:
    enabled: true
    minNodes: 3
    maxNodes: 20
    scaleDownDelay: "10m"

# High availability
highAvailability:
  enabled: true

  # Pod topology spread constraints
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app: todo-app

  # Pod anti-affinity
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app
              operator: In
              values:
                - todo-app
        topologyKey: kubernetes.io/hostname

# Resource quotas
resourceQuotas:
  enabled: true
  hard:
    requests.cpu: "20"
    requests.memory: "40Gi"
    limits.cpu: "40"
    limits.memory: "80Gi"
    persistentvolumeclaims: "10"

# Limits
limitRanges:
  enabled: true
  limits:
    - max:
        cpu: "2"
        memory: "4Gi"
      min:
        cpu: "100m"
        memory: "128Mi"
      type: Container
