# Azure Secrets Configuration
# For production, use Azure Key Vault with External Secrets Operator or CSI Driver
---
apiVersion: v1
kind: Secret
metadata:
  name: acr-secret
  namespace: production
type: kubernetes.io/dockerconfigjson
data:
  # Base64 encoded docker config - Update with actual ACR credentials
  # Generate with: kubectl create secret docker-registry acr-secret --docker-server=<ACR>.azurecr.io --docker-username=<USER> --docker-password=<PASS> --dry-run=client -o yaml
  .dockerconfigjson: ${ACR_DOCKER_CONFIG_JSON}
---
apiVersion: v1
kind: Secret
metadata:
  name: azure-secrets
  namespace: production
type: Opaque
stringData:
  # Azure Database for PostgreSQL
  database-url: "postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}.postgres.database.azure.com:5432/${DB_NAME}?sslmode=require"

  # Azure Cache for Redis
  redis-url: "rediss://:${REDIS_PASSWORD}@${REDIS_HOST}.redis.cache.windows.net:6380/0"

  # Azure Event Hubs (Kafka protocol)
  eventhub-connection: "Endpoint=sb://${EVENTHUB_NAMESPACE}.servicebus.windows.net/;SharedAccessKeyName=${EVENTHUB_KEY_NAME};SharedAccessKey=${EVENTHUB_KEY}"
  kafka-bootstrap-servers: "${EVENTHUB_NAMESPACE}.servicebus.windows.net:9093"
  kafka-sasl-username: "$ConnectionString"
  kafka-sasl-password: "${EVENTHUB_CONNECTION_STRING}"

  # Application secrets
  jwt-secret: "${JWT_SECRET}"
  encryption-key: "${ENCRYPTION_KEY}"

  # External API keys
  openai-api-key: "${OPENAI_API_KEY}"
  azure-speech-key: "${AZURE_SPEECH_KEY}"

  # Azure Application Insights
  appinsights-instrumentation-key: "${APPINSIGHTS_INSTRUMENTATIONKEY}"
  appinsights-connection-string: "${APPINSIGHTS_CONNECTION_STRING}"
---
# External Secrets Operator configuration (recommended for production)
# Uncomment and configure if using External Secrets Operator with Azure Key Vault
#
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: azure-keyvault
#   namespace: production
# spec:
#   provider:
#     azurekv:
#       authType: ManagedIdentity
#       vaultUrl: "https://${KEYVAULT_NAME}.vault.azure.net"
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: azure-secrets
#   namespace: production
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: azure-keyvault
#     kind: SecretStore
#   target:
#     name: azure-secrets
#   data:
#     - secretKey: database-url
#       remoteRef:
#         key: todo-app-database-url
#     - secretKey: redis-url
#       remoteRef:
#         key: todo-app-redis-url
#     - secretKey: jwt-secret
#       remoteRef:
#         key: todo-app-jwt-secret
